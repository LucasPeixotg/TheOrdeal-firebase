
    match /users/{userId} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;
    }

    match /campaigns/{campaignId} {

      allow write, read: if true;
      // Anyone authenticated can create or fetch a campaign
      allow create, get: if request.auth != null;

      allow update: if request.auth != null; 

      // --- Specific subcollections first ---
      match /members/{userId} {
        // User can add themselves as a member (userId must match auth.uid)
        allow create, update: if request.auth != null && request.auth.uid == userId;

        // Allow members to read
        allow read: if isMember(campaignId);
      }

      match /quests/{questId} {
        allow read, write: if isMember(campaignId);
      }

      // --- Catch-all for any other subcollections ---
      match /{sub=**} {
        allow read, update: if true;
      }

      function isMember(campaignId) {
        return request.auth != null &&
               exists(/databases/$(database)/documents/campaigns/$(campaignId)/members/$(request.auth.uid));
      }
    }